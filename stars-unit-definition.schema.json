{
  "$id": "stars-unit-definition@2.1",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Stars Player Unit Definition",
  "description": "Specification for the unit definition of the stars player.",
  "type": "object",
  "properties": {
    "id": {
      "const": "stars-unit-definition",
      "description": "Ensures that this is the right definition type"
    },
    "version": {
      "type": "string",
      "default": "1.5",
      "description": "Version to better support legacy definitions."
    },
    "backgroundColor": {
      "type": "string",
      "description": "web-color",
      "examples": [
        "#ffaa56",
        "#ff1"
      ],
      "default": "#eeeeee"
    },
    "ribbonBars": {
      "type": "boolean",
      "description": "If true, two striped bars are shown to indicate a special presentation mode.",
      "default": false
    },
    "firstAudioOptions": {
      "description": "Options for the first audio to be played (can be openingImage-audio or mainAudio).",
      "type": "object",
      "properties": {
        "firstClickLayer": {
          "type": "boolean",
          "description": "If true, an overlapping click area covers all available space to catch first click to start audio.",
          "default": false
        },
        "animateButton": {
          "type": "boolean",
          "description": "If true, the audio trigger button is a bit moving to demand attention.",
          "default": false
        }
      }
    },
    "continueButtonShow": {
      "type": "string",
      "description": "Rule if the navigation button to continue is presented",
      "enum": [
        "NO",
        "ALWAYS",
        "ON_MAIN_AUDIO_COMPLETE",
        "ON_VIDEO_COMPLETE",
        "ON_ANY_RESPONSE",
        "ON_AUDIO_AND_RESPONSE",
        "ON_RESPONSES_COMPLETE"
      ],
      "default": "ALWAYS"
    },
    "openingImage": {
      "description": "Centered (big) image to be presented before any interaction takes effect and before mainAudio.",
      "type": "object",
      "properties": {
        "audioSource": {
          "type": "string",
          "description": "Audio to be played before presentation of image; base64 coded string"
        },
        "imageSource": {
          "type": "string",
          "description": "Image base64-coded"
        },
        "presentationDurationMS": {
          "description": "Timespan/duration of presentation of the image in milliseconds",
          "type": "integer",
          "default": 1500
        }
      },
      "required": [
        "imageSource"
      ],
      "additionalProperties": false
    },
    "mainAudio": {
      "type": "object",
      "description": "Parameters and source for main audio sequence used via upper left button.",
      "properties": {
        "audioSource": {
          "type": "string",
          "description": "base64 coded string"
        },
        "maxPlay": {
          "type": "integer",
          "description": "Maximum number of plays. If '0', then no limit exists.",
          "default": 0
        },
        "disableInteractionUntilComplete": {
          "type": "boolean",
          "description": "If true, any interaction is disabled until the main audio has been played at least once. The continue button is not affected by this.",
          "default": false
        }
      },
      "required": [
        "audioSource"
      ],
      "additionalProperties": false
    },
    "interactionType": {
      "type": "string",
      "description": "Type of interaction",
      "enum": [
        "BUTTONS",
        "POLYGON_BUTTONS",
        "DROP",
        "WRITE",
        "FIND_ON_IMAGE",
        "VIDEO",
        "IMAGE_ONLY",
        "PLACE_VALUE"
      ]
    },
    "interactionMaxTimeMS": {
      "description": "After interaction start (after mainAudio and openingImage if given), the navigation to the next unit is forced when this milliseconds timespan is over.",
      "type": "integer",
      "default": 0
    },
    "interactionParameters": {
      "description": "Every interaction type needs a different set of parameters.",
      "oneOf": [
        {
          "$ref": "#/definitions/parametersDrop"
        },
        {
          "$ref": "#/definitions/parametersWrite"
        },
        {
          "$ref": "#/definitions/parametersFindOnImage"
        },
        {
          "$ref": "#/definitions/parametersVideo"
        },
        {
          "$ref": "#/definitions/parametersButtons"
        },
        {
          "$ref": "#/definitions/parametersPolygonButtons"
        },
        {
          "$ref": "#/definitions/parametersPlaceValue"
        }
      ]
    },
    "variableInfo": {
      "type": "array",
      "description": "Rules for coding and scoring the values",
      "items": {
        "$ref": "#/definitions/coding"
      },
      "minItems": 1
    },
    "audioFeedback": {
      "type": "object",
      "description": "",
      "properties": {
        "trigger": {
          "type": "string",
          "description": "Event triggering the evaluation of response(s) and playing feedback",
          "enum": [
            "CONTINUE_BUTTON_CLICK",
            "ANY_RESPONSE"
          ],
          "default": "CONTINUE_BUTTON_CLICK"
        },
        "feedback": {
          "type": "array",
          "description": "The feedback will be played for the variable just changed.",
          "items": {
            "$ref": "#/definitions/audioFeedback"
          },
          "minItems": 1
        }
      }
    }
  },
  "required": [
    "id",
    "interactionType"
  ],
  "additionalProperties": false,
  "definitions": {
    "option": {
      "description": "Text, image or icon are valid defintions of one button",
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "text": {
              "type": "string",
              "description": "Will be cropped if not enough space is given."
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "imageSource": {
              "type": "string",
              "description": "Image base64-coded"
            },
            "label": {
              "type": "string",
              "description": "Helps to identify the option if image can not be presented"
            },
            "audioSource": {
              "type": "string",
              "description": "Audio base64-coded; if this property is set, an audio play button will be placed near the image to start the audio."
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "icon": {
              "type": "string",
              "description": "Icon provided by player",
              "enum": [
                "CHECK_GREEN",
                "CLOSE_RED",
                "CLAP_HANDS",
                "SMILEY_1",
                "SMILEY_2",
                "SMILEY_3",
                "SMILEY_4",
                "SMILEY_5"
              ]
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "parametersButtons": {
      "type": "object",
      "description": "These parameters will be used for interactionTypes BUTTONS and IMAGE_ONLY",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable stored as id in the response data object.",
          "default": "BUTTONS"
        },
        "imageSource": {
          "type": "string",
          "description": "Stimulus image base64-coded."
        },
        "imagePosition": {
          "type": "string",
          "description": "DEPRECATED (Position of stimulus image)",
          "enum": [
            "TOP",
            "LEFT"
          ],
          "default": "LEFT"
        },
        "layout": {
          "type": "string",
          "description": "Position and alignment of text and image",
          "enum": [
            "TOP_CENTER",
            "LEFT_CENTER",
            "LEFT_CENTER_50",
            "LEFT_BOTTOM"
          ],
          "default": "LEFT_CENTER"
        },
        "imageUseFullArea": {
          "type": "boolean",
          "default": false
        },
        "text": {
          "type": "string",
          "description": "Stimulus text."
        },
        "buttonType": {
          "type": "string",
          "description": "Variant of button styling",
          "enum": [
            "BIG_SQUARE",
            "MEDIUM_SQUARE",
            "SMALL_SQUARE",
            "TEXT",
            "CIRCLE",
            "EXTRA_LARGE_SQUARE",
            "LONG_RECTANGLE",
            "TALL_RECTANGLE"
          ],
          "default": "MEDIUM_SQUARE"
        },
        "multiSelect": {
          "type": "boolean",
          "description": "If true, more than one option can be selected.",
          "default": false
        },
        "triggerNavigationOnSelect": {
          "type": "boolean",
          "description": "If true, the selection of any button triggers the navigation to the next unit (with short delay). No feedback is possible.",
          "default": false
        },
        "numberOfRows": {
          "type": "integer",
          "description": "The options are arranged in exact this number of rows regardless of the given space (no responsiveness). If an odd number of options is given, the upper row will contain of more options.",
          "default": 1
        },
        "options": {
          "oneOf": [
            {
              "type": "object",
              "description": "List of buttons.",
              "properties": {
                "buttons": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/option"
                  },
                  "minItems": 1
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Repeat one button.",
              "properties": {
                "repeatButton": {
                  "type": "object",
                  "description": "Repeat one selection button several times",
                  "properties": {
                    "numberOfOptions": {
                      "type": "integer",
                      "description": "Number of options. Every option carries a growing number of hand clapping images.",
                      "default": 5
                    },
                    "option": {
                      "$ref": "#/definitions/option"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "parametersDrop": {
      "type": "object",
      "description": "These parameters will be used for interactionType DROP",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable stored as id in the response data object.",
          "default": "DROP"
        },
        "imageSource": {
          "type": "string",
          "description": "Image base64-coded, placed at the bottom."
        },
        "imagePosition": {
          "type": "string",
          "description": "Position of the big main image.",
          "enum": [
            "TOP",
            "BOTTOM"
          ],
          "default": "BOTTOM"
        },
        "imageLandingXY": {
          "type": "string",
          "description": "Point on image where the selected button image will land (x,y - percentage of main image).",
          "examples": [
            "12,45",
            "50,50"
          ],
          "default": "50,50"
        },
        "text": {
          "type": "string",
          "description": "If an image is given too, this text is used as alt."
        },
        "options": {
          "type": "array",
          "description": "Each option specifies one button.",
          "items": {
            "$ref": "#/definitions/option"
          },
          "minItems": 1
        }
      },
      "required": [
        "options"
      ],
      "additionalProperties": false
    },
    "parametersWrite": {
      "type": "object",
      "description": "These parameters will be used for interactionType WRITE",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable stored as id in the response data object.",
          "default": "WRITE"
        },
        "imageSource": {
          "type": "string",
          "description": "Image base64-coded, placed at the top."
        },
        "text": {
          "type": "string",
          "description": "If image is given too, this text is used as alt."
        },
        "keyboardMode": {
          "type": "string",
          "description": "Keyboard base layout",
          "enum": [
            "CHARACTERS",
            "NUMBERS_LINE",
            "NUMBERS_BLOCK"
          ],
          "default": "CHARACTERS"
        },
        "addBackspaceKey": {
          "type": "boolean",
          "description": "If true, a backspace key is added to the keybboard.",
          "default": true
        },
        "addUmlautKeys": {
          "type": "boolean",
          "description": "If true, keys for umlauts are added to the keyboard.",
          "default": true
        },
        "keysToAdd": {
          "type": "array",
          "description": "All chars/strings in the list are added in a new key row at the bottom. Example: Graphemes",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "examples": [
            "eu",
            "au",
            "ei",
            "ch",
            "sch",
            "ng"
          ],
          "default": []
        },
        "maxInputLength": {
          "type": "integer",
          "description": "Maximal number of characters for input.",
          "default": 10
        }
      },
      "additionalProperties": false
    },
    "parametersFindOnImage": {
      "type": "object",
      "description": "These parameters will be used for interactionType FIND_ON_IMAGE",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable stored as id in the response data object.",
          "default": "FIND_ON_IMAGE"
        },
        "imageSource": {
          "type": "string",
          "description": "Image base64-coded, filling space as much as possible."
        },
        "text": {
          "type": "string",
          "description": "Placed below the image."
        },
        "size": {
          "type": "string",
          "description": "Size of circle to mark selected area. If options are given, this parameter works as default.",
          "enum": [
            "SMALL",
            "MEDIUM",
            "LARGE"
          ],
          "default": "MEDIUM"
        },
        "showArea": {
          "type": "string",
          "description": "This parameter visualises an area of the image. The position and size of the area is specified as 'x,y-x,y'. Use this parameter to prepare the coding and remove it before the test."
        }
      },
      "required": [
        "imageSource"
      ],
      "additionalProperties": false
    },
    "parametersVideo": {
      "type": "object",
      "description": "These parameters will be used for interactionType VIDEO",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable stored as id in the response data object. The variable holds the play progress value as parts of 1.",
          "default": "VIDEO"
        },
        "videoSource": {
          "type": "string",
          "description": "Video base64-coded, filling space as much as possible."
        },
        "imageSource": {
          "type": "string",
          "description": "Image base64-coded, used as placeholder before and after playing."
        },
        "text": {
          "type": "string",
          "description": "Placed below the video."
        }
      },
      "required": [
        "videoSource"
      ],
      "additionalProperties": false
    },
    "parametersPolygonButtons": {
      "type": "object",
      "description": "These parameters will be used for interactionType POLYGON_BUTTONS",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable stored as id in the response data object. The variable holds the selected button(s).",
          "default": "POLYGON_BUTTONS"
        },
        "multiSelect": {
          "type": "boolean",
          "description": "If true, more than one option can be selected.",
          "default": false
        },
        "options": {
          "type": "array",
          "description": "Each option specifies one polygon as button.",
          "items": {
            "type": "object",
            "properties": {
              "svgPath": {
                "type": "string",
                "description": "Path describing the polygon as svg element",
                "examples": [
                  "M 70,340 l 75,-100 l 140,0 l -65,100 z",
                  "M 200,400 l 0,150 l 150,0 l 0,-150 z"
                ]
              },
              "label": {
                "type": "string"
              }
            },
            "required": [
              "svgPath"
            ],
            "additionalProperties": false
          },
          "minItems": 1
        }
      },
      "additionalProperties": false,
      "required": [
        "options"
      ]
    },
    "parametersPlaceValue": {
      "type": "object",
      "description": "These parameters will be used for interactionType PLACE_VALUE",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable stored as id in the response data object.",
          "default": "PLACE_VALUE"
        },
        "value": {
          "type": "number",
          "description": "Value to be placed above the target area. If '0' no number will be shown.",
          "default": 0
        },
        "numberOfRows": {
          "type": "number",
          "description": "Defines the height of the target area.",
          "default": 5
        },
        "maxNumberOfTens": {
          "type": "number",
          "description": "Maximum number of ten-bars offered to the testtaker.",
          "default": 3
        },
        "maxNumberOfOnes": {
          "type": "number",
          "description": "Maximum number of one-chips offered to the testtaker.",
          "default": 20
        }
      },
      "additionalProperties": false
    },
    "code": {
      "type": "object",
      "description": "If more than one rule is given, the first will go.",
      "properties": {
        "method": {
          "type": "string",
          "description": "Method to compare value with parameter",
          "enum": [
            "EQUALS",
            "GREATER_THAN",
            "LESS_THAN",
            "IN_POSITION_RANGE",
            "SUM_CHAR_MATCHES"
          ]
        },
        "parameter": {
          "type": "string",
          "description": "Value to compare with"
        },
        "code": {
          "type": "integer"
        },
        "score": {
          "type": "integer"
        }
      },
      "required": [
        "method",
        "parameter",
        "code",
        "score"
      ],
      "additionalProperties": false
    },
    "coding": {
      "type": "object",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable to be coded."
        },
        "responseComplete": {
          "type": "string",
          "description": "Parameter to comply with Verona state changed notification",
          "enum": [
            "ALWAYS",
            "ON_ANY_RESPONSE",
            "ON_FULL_CREDIT"
          ],
          "default": "ALWAYS"
        },
        "codingSource": {
          "type": "string",
          "description": "Where the value for evaluation comes from.",
          "enum": [
            "VALUE",
            "VALUE_TO_UPPER",
            "SUM"
          ],
          "default": "VALUE"
        },
        "codes": {
          "type": "array",
          "description": "First true code will be taken. If not code matches, code and score will be '0'. If the given code list includes code '0', the next available code will be taken.",
          "items": {
            "$ref": "#/definitions/code"
          },
          "minItems": 1
        }
      },
      "required": [
        "variableId",
        "codes"
      ],
      "additionalProperties": false
    },
    "audioFeedback": {
      "type": "object",
      "properties": {
        "variableId": {
          "type": "string",
          "description": "Name of the variable to trigger the feedback."
        },
        "source": {
          "type": "string",
          "description": "Where the value for evaluation comes from.",
          "enum": [
            "VALUE",
            "CODE",
            "SCORE"
          ],
          "default": "CODE"
        },
        "method": {
          "type": "string",
          "description": "Method to compare value with parameter",
          "enum": [
            "EQUALS",
            "GREATER_THAN",
            "LESS_THAN"
          ],
          "default": "EQUALS"
        },
        "parameter": {
          "type": "string",
          "description": "Value to compare with"
        },
        "audioSource": {
          "type": "string",
          "description": "base64 coded string for audio sequence used via upper left button"
        }
      },
      "required": [
        "variableId",
        "parameter",
        "audioSource"
      ],
      "additionalProperties": false
    }
  }
}